import"../index.html";import"../assets/styles/index.css";const imageInput=document.getElementById("imageInput"),uploadedImage=document.getElementById("uploadedImage"),imageContainer=document.getElementById("imageContainer"),clearAllButton=document.getElementById("clearAll"),saveButton=document.getElementById("save");imageInput.addEventListener("change",(function(){const e=this.files[0];if(e){const t=new FileReader;t.onload=function(e){uploadedImage.src=e.target.result,uploadedImage.style.display="block",imageContainer.classList.remove("noImgProvide")},t.readAsDataURL(e),clearAllButton.disabled=!1,saveButton.disabled=!1}}));const addTextFieldButton=document.getElementById("addTextField");let offsetX,offsetY,activeTextField,lastTouchedTextField,textFields=[],isDragging=!1;function createTextField(){const e=document.createElement("div"),t=document.getElementById("textFieldText");return e.className="textBlock",e.textContent=t.value?t.value:"Жаль, что не все поймут в чем дело!",e.style.left="10px",e.style.top="10px",e.addEventListener("mousedown",(t=>{isDragging=!0,offsetX=t.clientX-e.getBoundingClientRect().left,offsetY=t.clientY-e.getBoundingClientRect().top,activeTextField=e,lastTouchedTextField=e,textFields.map((e=>e.classList.remove("active"))),lastTouchedTextField.classList.add("active"),e.style.zIndex="1"})),e}addTextFieldButton.addEventListener("click",(()=>{const e=createTextField();lastTouchedTextField=e,e.classList.add("active"),textFields.map((e=>e.classList.remove("active"))),textFields.push(e),imageContainer.appendChild(e),1===textFields.length&&(document.getElementById("fontSize").disabled=!1,document.getElementById("fontColor").disabled=!1,document.getElementById("fontWeight").disabled=!1)})),document.addEventListener("mousemove",(e=>{if(isDragging){const t=e.clientX-offsetX-imageContainer.getBoundingClientRect().left,n=e.clientY-offsetY-imageContainer.getBoundingClientRect().top;activeTextField&&t>=0&&t+activeTextField.offsetWidth<=imageContainer.offsetWidth&&n>=0&&n+activeTextField.offsetHeight<=imageContainer.offsetHeight&&(activeTextField.style.left=t+"px",activeTextField.style.top=n+"px")}})),document.addEventListener("mouseup",(()=>{isDragging=!1,activeTextField&&(activeTextField.style.zIndex="0",activeTextField=null)}));const fontSizeInput=document.getElementById("fontSize"),fontColorInput=document.getElementById("fontColor"),fontWeightSelect=document.getElementById("fontWeight");fontSizeInput.addEventListener("input",(()=>{lastTouchedTextField&&(lastTouchedTextField.style.fontSize=fontSizeInput.value+"px")})),fontColorInput.addEventListener("input",(()=>{lastTouchedTextField&&(lastTouchedTextField.style.color=fontColorInput.value)})),fontWeightSelect.addEventListener("change",(()=>{lastTouchedTextField&&(lastTouchedTextField.style.fontWeight=fontWeightSelect.value)})),document.addEventListener("click",(function(e){const t=[document.getElementById("controls"),...textFields,document.getElementById("addTextField")];Array.from(t).some((t=>t.contains(e.target)))||lastTouchedTextField&&(lastTouchedTextField.classList.remove("active"),lastTouchedTextField=null)}));const captureButton=document.getElementById("save");captureButton.addEventListener("click",(()=>{const e=document.getElementById("myCanvas"),t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);var n=new Image;n.src=uploadedImage.src,n.onload=function(){const l=e.width,d=l/n.width,o=l,i=n.height*d;e.width=o,e.height=i,t.drawImage(n,0,0,o,i),textFields.map((t=>{const n={fontSize:t.style.fontSize?+t.style.fontSize.slice(0,-2):26,fontWeight:t.style.fontWeight?t.style.fontWeight:"bold",fontColor:t.style.color?t.style.color:"white",left:+t.style.left.slice(0,-2),top:+t.style.top.slice(0,-2)};drawText(t.innerHTML,n,e)}))}}));const drawText=(e,t,n)=>{const l=n.getContext("2d"),d=t.fontSize,o=t.fontWeight;l.font=`${o} ${d}px sans-serif`;const i=t.fontColor;l.fillStyle=i;const a=[],s=e.split(" ");let c="",g=350;for(const e of s){const t=0===c.length?e:`${c} ${e}`,n=l.measureText(t).width;n<=350?(c=t,g=n):(a.push(c),c=e)}a.push(c),a.length>1&&(g=350);const u=t.left,m=t.top;l.textAlign="center",a.length,a.length;for(let e=0;e<a.length;e++)l.fillText(a[e],g/2+u+5,m+10+d/2+e*(d+5))};clearAllButton.addEventListener("click",(()=>{uploadedImage.style.display="none",imageContainer.classList.add("noImgProvide"),textFields.map((e=>{imageContainer.removeChild(e)})),textFields=[],imageInput.value="";const e=document.getElementById("myCanvas");e.getContext("2d").clearRect(0,0,e.width,e.height),clearAllButton.disabled=!0,saveButton.disabled=!0,document.getElementById("fontSize").disabled=!0,document.getElementById("fontColor").disabled=!0,document.getElementById("fontWeight").disabled=!0}));